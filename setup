echo -n "Are you running this from your home or initial directory?"

echo "First let's remove password requirements for sudo..."
sleep 3
sudo EDITOR=nano visudo

LINUX=false
cd /etc/apt/ > /dev/null 2>&1
if [ $? -eq 0 ]; then
    $LINUX=true
    sudo echo "APT::Get::Assume-Yes \"true\";" > /etc/apt/apt.conf.d/90forceyes
fi

if [ $LINUX ]; then
    echo "Updating packages..."
    sudo apt update > /dev/null 2>&1
    sudo apt upgrade > /dev/null 2>&1
    echo "Installing Zsh..."
    sudo apt install zsh > /dev/null 2>&1
    echo "Updating Shell to Zsh..."
    chsh -s $(which zsh)
else
    brew --version > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "Updating homebrew..."
        brew update > /dev/null 2>&1
        brew upgrade > /dev/null 2>&1
        brew doctor > /dev/null 2>&1
        brew cleanup > /dev/null 2>&1
    else
        echo "Installing Homebrew and iTerm 2..."
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
        brew doctor > /dev/null 2>&1
        brew cleanup > /dev/null 2>&1
        brew cask install iterm2 > /dev/null 2>&1
    fi
    echo "Installing Zsh..."
    brew install zsh > /dev/null 2>&1
    echo "Updating Shell to Zsh..."
    sudo sh -c "echo $(which zsh) >> /etc/shells" && chsh -s $(which zsh) > /dev/null 2>&1
fi
echo "Zsh set as shell. Log out & in to update terminal."

echo "Installing fonts..."
if [ $LINUX ]; then
    sudo apt install powerline fonts-powerline fonts-font-awesome > /dev/null 2>&1
else
    brew tap homebrew/cask-fonts > /dev/null 2>&1
    brew cask install font-awesome-terminal-fonts > /dev/null 2>&1
fi

echo "Installing git..."
if [ $LINUX ]; then
    sudo apt install git > /dev/null 2>&1
else
    brew install git > /dev/null 2>&1
fi

git config --global user.name "Noah Kiss" > /dev/null 2>&1
git config --global user.email "noah@noahkiss.com" > /dev/null 2>&1

echo "Setting up GitHub ssh key..."
echo "Please name file 'github_rsa'."

cd ~/.ssh/ > /dev/null 2>&1
if [ $? -eq 1 ]
    PATH=$(wslpath -u c:/users/$(whoami))
    cd $PATH/.ssh/
    echo "Host github.com\n    Hostname github.com\n    User noahkiss\n    IdentityFile $PATH/.ssh/github_rsa\n\n" >> config
    ssh-keygen.exe -t rsa -b 4096 -C "noah@noahkiss.com"
    cd ..
    cp ./.ssh ~/.ssh > /dev/null 2>&1
    echo "Host github.com\n    Hostname github.com\n    User noahkiss\n    IdentityFile ~/.ssh/github_rsa\n\n" > config
    echo "Add SSH key to GitHub..."
    cat ~/.ssh/github_rsa.pub
else
    echo "Host github.com\n    Hostname github.com\n    User noahkiss\n    IdentityFile ~/.ssh/github_rsa\n\n" >> config
    echo "github_rsa" | ssh-keygen -t rsa -b 4096 -C "noah@noahkiss.com"
    echo "Add SSH key to GitHub..."
    if [ $LINUX ]; then
        cat ~/.ssh/github_rsa.pub
    else
        cat ~/.ssh/github_rsa.pub | pbcopy
    fi
fi

echo -n "Press enter when done." && read NULVAR
echo "GitHub key successfully installed."

cd ~

echo "Cloning a lot of stuff from GitHub, this may take a while..."
git clone git@github.com:noahkiss/dotfiles.git > /dev/null 2>&1
git clone git@github.com:robbyrussell/oh-my-zsh.git ./.oh-my-zsh > /dev/null 2>&1
git clone git@github.com:zsh-users/zsh-syntax-highlighting.git ./.oh-my-zsh/custom/plugins/zsh-syntax-highlighting > /dev/null 2>&1
git clone git@github.com:zsh-users/zsh-autosuggestions.git ./.oh-my-zsh/custom/plugins/zsh-autosuggestions > /dev/null 2>&1
git clone git@github.com:lukechilds/zsh-nvm.git ./.oh-my-zsh/custom/plugins/zsh-nvm > /dev/null 2>&1
git clone --depth=1 git@github.com:romkatv/powerlevel10k.git ./.oh-my-zsh/custom/themes/powerlevel10k > /dev/null 2>&1
git clone --depth=1 git@github.com:ryanoasis/nerd-fonts.git ./.nerd-fonts > /dev/null 2>&1

echo "Cloning done, now installing and moving files..."
cd .nerd-fonts
chmod +x install.sh
./install.sh > /dev/null 2>&1
cd ..

yes | cp ./dotfiles/.zshrc ./.zshrc > /dev/null 2>&1
if [ $LINUX ]; then
    yes | cp ./dotfiles/.p10k.zsh.ubuntu ./.p10k.zsh > /dev/null 2>&1
else
    yes | cp ./dotfiles/.p10k.zsh.mac ./.p10k.zsh > /dev/null 2>&1
fi

echo "All done. Please don't forget to run 'nvm install --lts' after logging out."
echo -n "Restart? [y/n]: " && read do_restart
if [ $do_restart ]; then
    sudo reboot > /dev/null 2>&1
    if [ $? -eq 1 ]; then
        sudo touch /var/run/reboot-required
        sudo killall -r '.*'
    fi
fi
echo "Closing terminal."
pause 3
exit
